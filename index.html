<!doctype html>
<html>

<head>
  <script src="./bundle.js"></script>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="./assets/icon.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orchestre JS</title>
</head>

<body>
  <header>
    <img src="./assets/logo.svg" height="80px" />
    <h1>Orchestre-JS</h1>
    <p>A web tool to create dynamic music</p>
    <button onclick="start()" id="startButton">Start the audio demo</button>
    <p id="loading" class="hidden" aria-live="assertive" aria-relevant="text">Loading…</p>
    <p id="error" class="hidden" aria-live="assertive" aria-relevant="text">
      <strong>Something went wrong! You might need to try another browser?</strong>
    </p>
  </header>


  <main role="main" aria-live="polite" aria-relevant="additions">

    <div id="control" class="hidden">
      <h2 class="sr-only">Controls</h2>
      <button onclick="pause()" id="pause-btn">
        <img id="pause-icon" src="./assets/pause.svg" alt="Pause" height="15rem" />
      </button>
      <img id="pause-icon" src="./assets/volume.svg" aria-hidden="true" height="15rem" />
      <button onclick="changeVolume(false)" aria-label="Volume down" id="vol-down-btn">-</button>
      <button onclick="changeVolume(true)" aria-label="Volume up" disabled class="disabled" id="vol-up-btn">+</button>
    </div>

    <div id="demo" class="hidden">
      <div class="text" id="init">
        <h2>Initialization</h2>
        Initialize an orchestra by providing your song's BPM, then start adding players. Each player represents a
        musical layer that will play in loop. It needs a name, an audio file, and a length in beat.
      </div>
      <div class="code">
        <pre>
const orchestre = new Orchestre(120);
await orchestre.addPlayers([
  {name: 'bass', url: './assets/bass.ogg', length: 16, position: 'absolute'},
  {name: 'melody', url: './assets/melody.ogg', length: 8, position: 'relative'},
  // etc...
])
orchestre.start();
</pre>
      </div>

      <div class="text" id="players">
        <h2>Play</h2>
        <p>
          Activate and deactivate your players to make them play in sync.<br />
          There are two kinds of players: absolute and relative. Play around with them to hear the difference!
        </p>
        <div class="players">
          <div>
            <h3>Absolute</h3>
            <button onclick="bass()" id="bass-btn" aria-pressed="false">Bass (16 beats)</button>
            <button onclick="piano()" id="piano-btn" aria-pressed="false">Piano (16 beats)</button>
            <p>Will always stay on the same beats</p>
          </div>
          <div>
            <h3>Relative</h3>
            <button onclick="melody()" id="melody-btn" aria-pressed="false">Melody (8 beats)</button>
            <button onclick="organ()" id="organ-btn" aria-pressed="false">Organ (7 beats)</button>
            <p>Will play on the first beat when activated</p>
          </div>
        </div>
      </div>
      <div class="code">
        <pre>
orchestre.play('bass');
</pre>
        <pre>
orchestre.stop('bass');
</pre>
        <pre>
// alternate between play and stop
orchestre.toggle('bass');
</pre>
      </div>

      <div class="text" id="options">
        <h2>Options</h2>
        <p>Orchestre-JS comes with several options to trigger audio layers in different ways.</p>

        <div id="options-players">
          <div class="player">
            <p>Play or stop immediately with a fade in and fade out</p>
            <button onclick="synth()" id="synth-btn" aria-pressed="false">Synth</button>
          </div>
          <div class="player">
            <p>Play only once</p>
            <button onclick="jingle()" id="jingle-btn">Jingle</button>
          </div>
          <div class="player shamisen">
            <p>Schedule player on next 2 bars</p>
            <button onclick="playShamisen()" id="play-shamisen-btn">Play Shamisen</button>
            <div id="scheduler">
              <span>(Scheduled…)</span>
            </div>
          </div>
          <div class="player shamisen">
            <p>Stop loop but let the track end</p>
            <button onclick="stopShamisen()" id="stop-shamisen-btn" disabled class="disabled">Stop Shamisen</button>
          </div>
        </div>
      </div>
      <div class="code">
        <pre>
orchestre.toggle('synth', {
  now: true,
  fade: 1.2
});
</pre>
        <pre>
orchestre.play('jingle', {
  once: true
});
</pre>
        <pre>
orchestre.schedule("shamisen", 8, "play", {
  absolute: true,
});
</pre>
        <pre>
orchestre.stop("shamisen", {
  keep: true,
});
  </pre>
      </div>

      <div class="text" id="events">
        <h2>Events</h2>
        <p>Subscribe to events to trigger actions on beat.</p>
        <div class="players">
          <div>
            <button onclick="count()" id="count-btn">Count to 8</button>
            <div id="eight" aria-live="assertive" aria-relevant="text">
              EIGHT!
            </div>
          </div>
          <div>
            <p>Called every two beats</p>
            <div id="beat" class="off">
              <div></div>
              <span class="sr-only" id="beat-text">off</span>
            </div>
            <button id="animation-stop" onclick="animationStop()">Stop the animation</button>
          </div>
        </div>
      </div>
      <div class="code">
        <pre>
await orchestre.wait(8);
</pre>
        <pre>
let listenerId = orchestre.addListener(() => { playAnimation() }, 2);
</pre>
        <pre>
orchestre.removeListener(listenerId);
</pre>
      </div>

    </div>
  </main>

  <footer>
    <a href="https://github.com/ClementRivaille/orchestre-js">View it on Github</a>
  </footer>
</body>

</html>